CC=gcc
CCFLAGS=-arch arm -isysroot /Developer/SDKs/iPhoneOS2.0.sdk -nomultidefs -O3 -fvisibility=hidden
LD=gcc
LDFLAGS=-arch arm -isysroot /Developer/SDKs/iPhoneOS2.0.sdk -framework CoreFoundation -framework IOKit

all:				pusher

secure:				CCFLAGS=-arch arm -isysroot /Developer/SDKs/iPhoneOS2.0.sdk -nomultidefs -O3 -fvisibility=hidden -DSECURE_PUSHER=1
secure:				pusher

test:				CCFLAGS=-nomultidefs -O3 -fvisibility=hidden -DTEST
test:				LDFLAGS=-framework CoreFoundation -framework IOKit
test:				all

itest:				CCFLAGS=-arch arm -isysroot /Developer/SDKs/iPhoneOS2.0.sdk -nomultidefs -O3 -fvisibility=hidden -DTEST
itest:				all

iid:				install-installerd

install-installerd:				install-installerd.o
								$(LD) $(LDFLAGS) -o $@ $^
								strip $@
								codesign -s ripdev.com $@				

dpkg-restate:				dpkg-restate.o
							$(LD) $(LDFLAGS) -o $@ $^
							strip $@
							codesign -s ripdev.com $@

pusher:			pusher.o utilities.o nor.o
				$(LD) $(LDFLAGS) -o $@ $^
				strip $@
				codesign -s ripdev.com $@

%.o:				%.c
					$(CC) -c $(CCFLAGS) $< -o $@
					
clean:
					rm -f *.o pusher
